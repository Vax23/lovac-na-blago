CREATE TABLE OBICNA_NALAZISTA_ZLATA
(
	ID NUMBER(5) PRIMARY KEY,
	IME VARCHAR2(20) NOT NULL,
	ZEMLJA_NALAZENJA VARCHAR2(20) NOT NULL,
	IME_NALAZACA VARCHAR2(20) NOT NULL,
	DATUM_OTKRIVANJA DATE,
	TIP VARCHAR2(20) CHECK (TIP IN ('Zlatonosne reke', 'Zlatne zile')),
	IME_REKE VARCHAR2(20)
);

CREATE TABLE POREKLO
(
	ID NUMBER(5) PRIMARY KEY,
	TIP VARCHAR2(50) CHECK (TIP IN ('Blago vitezova Templara', 'Gusarsko blago', 'Blago nestalih civilizacija', 'Blago nepoznatog porekla')),
	TIP_CIVILIZACIJE VARCHAR2(20) CHECK (TIP_CIVILIZACIJE IN ('Egipat', 'Maje', 'Vikinzi', 'Inke', 'Atlantida'))
);

CREATE TABLE LOKACIJA 
(
	ID NUMBER(5) PRIMARY KEY,
	NAZIV VARCHAR2(20) NOT NULL,
	ZEMLJA_NALAZENJA VARCHAR2(20) NOT NULL,
	TIP VARCHAR2(20) CHECK (TIP IN ('Piramida', 'Grobnica', 'Ukleti zamak', 'Grad duhova', 'Pecina', 'Ostrvo')),
	ID_BLAGA NUMBER(5),
	CONSTRAINT LOKACIJA_FK FOREIGN KEY(ID_BLAGA) REFERENCES BLAGO(ID)
);

CREATE TABLE BLAGO
(
	ID NUMBER(5) PRIMARY KEY,
	NAZIV VARCHAR2(20) NOT NULL,
	MAPA VARCHAR2(20) CHECK (MAPA IN ('Postoji', 'Ne postoji')),
	ID_POREKLA NUMBER(5),
	CONSTRAINT BLAGO_FK FOREIGN KEY(ID_POREKLA) REFERENCES POREKLO(ID)
);

CREATE TABLE LOVAC
(
	IME VARCHAR2(20),
	ID_BLAGA NUMBER(5),
	POCETAK_TRAZENJA DATE,
	KRAJ_TRAZENJA DATE,
	CONSTRAINT PRIMARY KEY(IME,ID_BLAGA),
	CONSTRAINT LOVAC_BLAGO_FK FOREIGN KEY(ID_BLAGA) REFERENCES BLAGO(ID)
);

CREATE TABLE PREDMET
(
	ID NUMBER(5) PRIMARY KEY,
	NAZIV VARCHAR2(40) NOT NULL,
	TIP VARCHAR2(20) CHECK (TIP IN ('Lobanja', 'Krst', 'Mac', 'Knjiga')),
	MATERIJAL VARCHAR2(20) CHECK (MATERIJAL IN ('Zlato', 'Srebro', 'Dijamant', 'Metal', 'Papir')),
	ID_BLAGA NUMBER(5),
	CONSTRAINT PREDMET_FK FOREIGN KEY(ID_BLAGA) REFERENCES BLAGO(ID)
);

CREATE TABLE LEGENDA
(
	ID NUMBER(5) PRIMARY KEY,
	NAZIV VARCHAR2(20) NOT NULL,
	ID_BLAGA NUMBER(5),
	PRICA VARCHAR2(1000)NOT NULL,
	CONSTRAINT LEGENDA_FK FOREIGN KEY(ID_BLAGA) REFERENCES BLAGO(ID)
);

CREATE TABLE ZASTITA
(
	ID NUMBER(5) PRIMARY KEY,
	NAZIV VARCHAR2(20) NOT NULL,
	TIP VARCHAR2(20) CHECK (ZASTITA IN ('Duh', 'Zmaj', 'Kletva'))
);

CREATE TABLE DEFINISE
(
	ID_LEGENDE NUMBER(5),
	ID_LOKACIJE NUMBER(5),
	ID_ZASTITE NUMBER(5),
	CONSTRAINT PRIMARY KEY (ID_LEGENDE,ID_LOKACIJE, ID_ZASTITE),
	CONSTRAINT DEFINISE_FK FOREIGN KEY(ID_LEGENDE) REFERENCES LEGENDA(ID),
	CONSTRAINT DEFINISE_FK FOREIGN KEY(ID_LOKACIJE) REFERENCES LOKACIJA(ID),
	CONSTRAINT DEFINISE_FK FOREIGN KEY(ID_ZASTITE) REFERENCES ZASTITA(ID)
);


---KREIRANJE SEKVENCE
CREATE SEQUENCE  "OBICNA_NALAZISTA_ZLATA_ID_SEQ"  MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 21 CACHE 20 NOORDER  NOCYCLE ;

---KREIRANJE TRIGERA
CREATE OR REPLACE TRIGGER OBICNA_NALAZISTA_ZLATA_PK
	BEFORE INSERT ON OBICNA_NALAZISTA_ZLATA
	REFERENCING NEW AS NEW 
	FOR EACH ROW
BEGIN
	SELECT OBICNA_NALAZISTA_ZLATA_ID_SEQ.NEXTVAL INTO :NEW.ID FROM DUAL;
END;

---KREIRANJE SEKVENCE
CREATE SEQUENCE  "POREKLO_ID_SEQ"  MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 21 CACHE 20 NOORDER  NOCYCLE ;

---KREIRANJE TRIGERA
CREATE OR REPLACE TRIGGER POREKLO_PK
	BEFORE INSERT ON POREKLO
	REFERENCING NEW AS NEW 
	FOR EACH ROW
BEGIN
	SELECT POREKLO_ID_SEQ.NEXTVAL INTO :NEW.ID FROM DUAL;
END;

---KREIRANJE SEKVENCE
CREATE SEQUENCE  "ZASTITA_ID_SEQ"  MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 21 CACHE 20 NOORDER  NOCYCLE ;

---KREIRANJE TRIGERA
CREATE OR REPLACE TRIGGER ZASTITA_PK
	BEFORE INSERT ON ZASTITA
	REFERENCING NEW AS NEW 
	FOR EACH ROW
BEGIN
	SELECT ZASTITA_ID_SEQ.NEXTVAL INTO :NEW.ID FROM DUAL;
END;

